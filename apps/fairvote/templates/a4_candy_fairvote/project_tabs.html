{% load i18n rules react_follows react_choins react_user_idea_choins thumbnail wagtailcore_tags a4_candy_project_tags offlineevent_tags contrib_tags ckeditor_tags static %}

<div class="tablist project-header__tabs">
    <nav class="nav d-none d-md-inline-block" role="tablist">
        <a
            id="tab-project-{{ project.pk }}-participation"
            class="tab"
            data-bs-toggle="tab"
            href="#tabpanel-project-{{ project.pk }}-participation"
            role="tab"
            aria-controls="tabpanel-project-{{ project.pk }}-participation"
            aria-expanded="true">
            {% translate 'Participation' %}
        </a>
        <a
            id="tab-project-{{ project.pk }}-history"
            class="tab active"
            href="{% url 'choinevent-list' organisation_slug=project.organisation.slug %}"
            role="tab"
            aria-controls="tabpanel-project-{{ project.pk }}-history"
            aria-expanded="false">
            {% translate 'History' %}
        </a>
        <a
            id="tab-project-{{ project.pk }}-accepted"
            class="tab"
            href="{% url 'accepted_ideas' organisation_slug=project.organisation.slug obj_id=project.pk %}"
            role="tab"
            aria-controls="tabpanel-project-{{ project.pk }}-accepted"
            aria-expanded="false">
            {% translate 'Accepted Ideas' %}
        </a>
    </nav>
    {% include 'includes/project_header_mobile_toggle.html' %}
</div>

<div
    class="tabpanel tabpanel--topnav"
    id="tabpanel-project-{{ project.pk }}-participation"
    role="tabpanel"
    aria-labelledby="tab-project-{{ project.pk }}-participation"
    aria-expanded="true">
    <div class="timeline-carousel__wrapper">
        {% if project.display_timeline %}
            {% include "a4_candy_projects/includes/project_timeline-carousel.html" with dates=project.participation_dates project=project %}
        {% else %}
            <h2 class="visually-hidden">{% translate 'Online participation' %}</h2>
        {% endif %}
        </div>
        <div class="container">
            {% if event %}
            <div class="row">
                <div class="col-md-8 col-lg-6 offset-md-2 offset-lg-3">
                    <h2>{{ event.name }}</h2>
                    <div class="phase-info__item__subtitle">
                        {% html_date event.date 'DATETIME_FORMAT' %}
                    </div>
                    <P>{{ event.description | safe}}</P>
                </div>
            </div>

            {% elif view.is_project_view %}
            <div class="row">
                <div class="col-md-10 offset-md-1 col-lg-8 offset-lg-2">
                    <ul class="l-tiles-3">
                    {% for module in modules %}
                        {% include "a4_candy_projects/includes/project_list_tile.html" with object=module  project=module.project orientation='vertical' type='module' url=module.get_absolute_url %}
                    {% endfor %}
                    </ul>
                </div>
            </div>

            {% else %} <!-- if just one module and no phase view to dispatch to -->
            <div class="row">
                <div class="col-md-8 offset-md-2 mb-3">
                    {% block module_description %}
                        {% if module.phases.first.type != 'a4_candy_interactive_events:issue' %}
                        <h1 class="project-header__title">{{ module.name }}</h1>
                            <!---{% if module.blueprint_type == 'FV' %}
                                {% react_choins module %}
                            {% endif %}-->
                        <p class="project-header__description">{{ module.description }}</p>
                        {% endif %}
                    {% endblock %}
                </div>
            </div>
            {% if module.phases.first.type != 'a4_candy_interactive_events:issue' %}
                {% if not module.active_phase %}
                <div class="row">
                    <div class="col-md-10 col-lg-8 offset-md-1 offset-lg-2 mb-3">
                        <strong>
                            {% translate 'Participation is not possible at the moment.' %}
                            {% if not module.past_phases %}
                                {% html_date module.future_phases.first.start_date 'DATETIME_FORMAT' as start_date %}
                                {% blocktranslate with date=start_date %}It starts on {{ date }}.{% endblocktranslate%}
                            {% elif module.future_phases %}
                                {% html_date module.future_phases.first.start_date 'DATETIME_FORMAT' as start_date %}
                                {% blocktranslate with date=start_date %}It continues on {{ date }}.{% endblocktranslate%}
                            {% else %}
                                {% html_date module.past_phases.last.end_date 'DATETIME_FORMAT' as end_date %}
                                {% blocktranslate with date=end_date %}It ended on {{ date }}.{% endblocktranslate%}
                            {% endif %}
                        </strong>
                    </div>
                </div>
                {% endif %}
                {% with phase_count=module.phases.count %}
                <div class="row">
                    <div class="col-md-10 col-lg-8 offset-md-1 offset-lg-2">
                        {% for phase in module.phases %}
                            {% if phase.is_over or phase == module.active_phase %}
                            <div class="phase-info__item {% if phase_count == 1 %} u-no-border {% endif %}">
                                <div class="fw-bold{% if phase == module.active_phase %} lr-bar{% endif %}">
                                    {% if phase == module.active_phase %}
                                        <span class="lr-bar__left">{{ phase.name }}</span>
                                        <span class="lr-bar__right text-primary">{% translate 'active' %}</span>
                                    {% else %}
                                        {{ phase.name }}
                                    {% endif %}
                                </div>
                                <div class="phase-info__item__subtitle">
                                    {% html_date phase.start_date 'DATETIME_FORMAT' %}
                                    &ndash; {% html_date phase.end_date 'DATETIME_FORMAT' %}
                                </div>
                                <div class="phase-info__item__description">
                                    {{ phase.description }}
                                </div>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            {% endwith %}
            {% endif %}
            {% endif %}
        </div>
        {% if not view.is_project_view and not event %}
        <div class="container">
            <div class="row">
            {% if project.is_private %}
                <div class="col-md-10 col-lg-8 offset-md-1 offset-lg-2 u-font-size-xs my-4">
                    <i class="fas fa-lock pe-2" aria-hidden="true"></i>{% translate 'This project is not publicly visible. Only invited users can see content and actively participate.' %}
                </div>
            {% elif project.is_semipublic %}
                <div class="col-md-10 col-lg-8 offset-md-1 offset-lg-2 u-font-size-xs my-4">
                    <i class="fas fa-eye pe-2" aria-hidden="true"></i>{% translate 'This project is publicly visible. Invited users can actively participate.' %}
                </div>
            {% endif %}
            </div>
        </div>
        {% endif %}
        <!-- these blocks are only filled when in phase view -->
        
        {% block phase_content %}{% endblock %}
    </div>
    </div>


    <div
        class="tabpanel tabpanel--topnav"
        id="tabpanel-project-{{ project.pk }}-result"
        role="tabpanel"
        aria-labelledby="tab-project-{{ project.pk }}-result"
        aria-expanded="false">
        <div class="container">
        {% if project.insight.display %}
            <div class="row">
                <div class="col-md-10 col-lg-8 offset-md-1 offset-lg-2">
                    <h5>{% translate 'Insights' %}</h5>
                    <p class="form-hint"> {{ insight_label }} </p>

                    <dl class="row">
                    {% for label, value in counts %}
                    <div class="col-sm-6 col-lg-4 text-center mb-2">
                        <dt class="dt--insight">{{ value }}</dt>
                        <dd>{{ label|title }}</dd>
                    </div>
                    {% endfor %}
                    </dl>
                </div>
            </div>
        {% endif %}

            <div class="row">
                <div class="col-md-10 col-lg-8 offset-md-1 offset-lg-2">
                    <h5>{{ result_title|title }}</h5>
                </div>
                <div class="col-md-10 col-lg-8 offset-md-1 offset-lg-2">
                    {% if project.result %}
                        {{ project.result | transform_collapsibles | richtext }}
                    {% else %}
                        {% translate 'No results yet.' %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div
        class="tabpanel tabpanel--topnav active"
        id="tabpanel-project-{{ project.pk }}-history"
        role="tabpanel"
        aria-labelledby="tab-project-{{ project.pk }}-history"
        aria-expanded="true">
        <div class="timeline-carousel__wrapper">
        </div>
        </div>